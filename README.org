#+TITLE: Emacs configuration

Emacs is a fully programmable text editor which employs extensions, made available as packages, in order to accomplish a myriad of needs.

General purpose packages

| Package                 | Purpose |
|-------------------------+---------|
| projectile              |         |
| undo-tree               |         |
| highlight-symbol        |         |
| goto-chg                |         |
| company                 |         |
| yasnippet               |         |
| yatemplate              |         |
| smartparens             |         |
| helm                    |         |
| neotree                 |         |
| magit                   |         |
| monky                   |         |
| gist                    |         |
| find-file-in-repository |         |
| multiple-cursors)       |         |
| window-numbering        |         |
| expand-region           |         |
| monokai-theme           |         |


Packages for programming languages

| Package         | Purpose                            |
|-----------------+------------------------------------|
| scala-mode      | Scala language                     |
| typescript-mode | Typescript language                |
| lua-mode        | Lua language                       |
| ensime          | IDE for Scala and Java development |
| tide            | IDE for Typescript development     |


* First of all: a silent bootstrap

#+BEGIN_SRC emacs-lisp 
;; Turn off mouse interface early in startup to avoid momentary display
(if (fboundp 'menu-bar-mode) (menu-bar-mode -1))
(if (fboundp 'tool-bar-mode) (tool-bar-mode -1))
(if (fboundp 'scroll-bar-mode) (scroll-bar-mode -1))

;; No splash screen please ... jeez
(setq inhibit-startup-message t)
#+END_SRC

* Load packages

#+BEGIN_SRC emacs-lisp 
;; Package repositories
(require 'package)
(add-to-list 'package-archives
             '("melpa" . "http://melpa.org/packages/") t)
(when (< emacs-major-version 24)
  (add-to-list 'package-archives '("gnu" . "http://elpa.gnu.org/packages/")))

;; Fetch list of available packages
(package-initialize) 
(unless package-archive-contents (package-refresh-contents))

;; List the package we want
(setq package-list '(use-package diminish bind-key
		     projectile undo-tree highlight-symbol goto-chg company yasnippet yatemplate smartparens helm
		     neotree magit monky gist find-file-in-repository 
                     multiple-cursors window-numbering expand-region
		     monokai-theme
		     scala-mode typescript-mode lua-mode
		     markdown-mode markdown-preview-eww 
                     ;ensime slime yafolding dumb-jump ag
		     ;rainbow-delimiters 
))

;; Install the packages that are missing, if any
(dolist (package package-list)
	(unless (package-installed-p package)
		(package-install package)))
#+END_SRC

* Employ /use-package/ for package configuration

#+BEGIN_SRC emacs-lisp 
;; Wire use-package https://github.com/jwiegley/use-package
(eval-when-compile (require 'use-package))
(require 'diminish)                ;; if you use :diminish
(require 'bind-key)                ;; if you use any :bind variant
#+END_SRC

* Configure basic extensions

** /projectile/

#+BEGIN_SRC emacs-lisp 
(use-package projectile
  :demand
  :init   (setq projectile-use-git-grep t)
  :config (projectile-global-mode t)
  :bind   (("s-f" . projectile-find-file)
           ("s-F" . projectile-grep)))
#+END_SRC

** /undo-tree/

#+BEGIN_SRC emacs-lisp 
(use-package undo-tree
  :diminish undo-tree-mode
  :config (global-undo-tree-mode)
  :bind ("s-/" . undo-tree-visualize))
#+END_SRC

** /highlight-symbol/

#+BEGIN_SRC emacs-lisp 
(use-package highlight-symbol
  :diminish highlight-symbol-mode
  :commands highlight-symbol
  :bind ("s-h" . highlight-symbol))
#+END_SRC

** /goto-chg/

#+BEGIN_SRC emacs-lisp 
(use-package goto-chg
  :commands goto-last-change
  ;; complementary to
  ;; C-x r m / C-x r l
  ;; and C-<space> C-<space> / C-u C-<space>
  :bind (("C-." . goto-last-change)
         ("C-," . goto-last-change-reverse)))
#+END_SRC

** /company/

#+BEGIN_SRC emacs-lisp 
(use-package company
  :diminish company-mode
  :commands company-mode
  :init
    (setq
     company-dabbrev-ignore-case nil
     company-dabbrev-code-ignore-case nil
     company-dabbrev-downcase nil
     company-idle-delay 0
     company-minimum-prefix-length 4)
  :config
    ;; disables TAB in company-mode, freeing it for yasnippet
    (define-key company-active-map [tab] nil)
    (define-key company-active-map (kbd "TAB") nil))
#+END_SRC

** /yasnippet/

#+BEGIN_SRC emacs-lisp 
(use-package yasnippet
  :diminish yas-minor-mode
  :commands yas-minor-mode
  :config (yas-reload-all))
#+END_SRC

** /yatemplate/

#+BEGIN_SRC emacs-lisp 
(use-package yatemplate
  :defer 2 ;; WORKAROUND https://github.com/mineo/yatemplate/issues/3
  :config
    (auto-insert-mode)
    (setq auto-insert-alist nil)
    (yatemplate-fill-alist))
#+END_SRC

** /smartparens/

#+BEGIN_SRC emacs-lisp 
(use-package smartparens
  :diminish smartparens-mode
  :commands
    smartparens-strict-mode
    smartparens-mode
    sp-restrict-to-pairs-interactive
    sp-local-pair
  :init (setq sp-interactive-dwim t)
  :config
    (require 'smartparens-config)
    (sp-use-smartparens-bindings)
    (sp-pair "(" ")" :wrap "C-(") ;; how do people live without this?
    (sp-pair "[" "]" :wrap "s-[") ;; C-[ sends ESC
    (sp-pair "{" "}" :wrap "C-{")
    ;; WORKAROUND https://github.com/Fuco1/smartparens/issues/543
    (bind-key "C-<left>"  nil smartparens-mode-map)
    (bind-key "C-<right>" nil smartparens-mode-map)
    (bind-key "s-<delete>"    'sp-kill-sexp smartparens-mode-map)
    (bind-key "s-<backspace>" 'sp-backward-kill-sexp smartparens-mode-map))
#+END_SRC

** /helm/

#+BEGIN_SRC emacs-lisp 
(use-package helm
  :bind (("M-x"     . helm-M-x)
         ("C-x C-m" . helm-M-x)
         ("C-x C-f" . helm-find-files)))
#+END_SRC

** /neotree/

#+BEGIN_SRC emacs-lisp 
(use-package neotree
  :init (neotree)
  :bind ("s-d" . neotree-toggle))
#+END_SRC

** Source Control tools

*** /magit/ is a powerful frontend for Git

#+BEGIN_SRC emacs-lisp 
(use-package magit
  :config (setq magit-last-seen-setup-instructions "1.4.0")
  :bind ("M-s M-g" . magit-status))
#+END_SRC

*** /monky/ is a powerful frontend for Mercurial

#+BEGIN_SRC emacs-lisp 
(use-package monky
  :init (setq monky-process-type 'cmdserver)
  :bind ("M-s M-m" . monky-status))
#+END_SRC

*** /gist/ allows managing gists hosted in Github

#+BEGIN_SRC emacs-lisp 
(use-package gist
  :bind (("M-s M-o" . gist-list)
	 ("M-s M-s" . gist-region-or-buffer)))
#+END_SRC
  
*** /find-file-in-repository/ gives access to files in source control

#+BEGIN_SRC emacs-lisp 
(use-package find-file-in-repository
  :bind ("M-s M-f" . find-file-in-repository))
#+END_SRC

** /multiple-cursors/

#+BEGIN_SRC emacs-lisp 
(use-package multiple-cursors)
#+END_SRC

** /window-numbering/

#+BEGIN_SRC emacs-lisp 
(use-package window-numbering
  :init (window-numbering-mode 1))
#+END_SRC

** /expand-region/

#+BEGIN_SRC emacs-lisp 
(use-package expand-region
  :bind ("C-=" . er/expand-region))
#+END_SRC
  
** /monokai-theme/

#+BEGIN_SRC emacs-lisp 
(use-package monokai-theme
  :config (load-theme 'monokai t)
  :init (setq frame-background-mode 'dark))
#+END_SRC

* Configure programming language modes

Pending packages for programming languages

| Package         | Purpose                            |
|-----------------+------------------------------------|
| ensime          | IDE for Scala and Java development |
| tide            | IDE for Typescript development     |

#+BEGIN_SRC emacs-lisp 
;(require 'rainbow-delimiters)
;(add-hook 'scala-mode-hook #'rainbow-delimiters-mode)
;(add-hook 'emacs-lisp-mode-hook #'rainbow-delimiters-mode)

;(add-hook 'scala-mode-hook #'smartparens-mode)
;(add-hook 'typescript-mode-hook #'smartparens-mode)
;(add-hook 'js-mode-hook #'smartparens-mode)
#+END_SRC

* Global keybindings and configurations

#+BEGIN_SRC emacs-lisp 
(global-set-key (kbd "C-\\") 'cua-rectangle-mark-mode)
(global-set-key (kbd "RET")  'newline-and-indent)
(cua-mode)
#+END_SRC
